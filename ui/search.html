<html>
  <body>
    <input id="include-branded" type="checkbox" name="include-branded">
    <label for="include-branded">Include Branded foods</label>
    <input id="search-query" type="text" style="width: 100%;display: inline-block;">
    <select id="search-results" size=15 style="width: 49%"></select>
    <div id="search-details" style="width: 49%;height: 200px; overflow: auto; display: inline-block">Details</div>

    <script>
      const includeBranded = document.getElementById('include-branded');
      const queryInput = document.getElementById('search-query');
      const searchResults = document.getElementById('search-results');
      const searchDetails = document.getElementById('search-details');

      let detailsByFdcId = {};
      function onSuccess(queryResults) {
        // Clear details
        detailsByFdcId = {}
        // Clear search reults
        while (searchResults.firstChild) {
          searchResults.removeChild(searchResults.firstChild);
        }
        // Add new results
        queryResults.forEach(function(result) {
          detailsByFdcId[result.fdcId] = result;
          var option = document.createElement('option');
          option.appendChild(document.createTextNode(result.description));
          option.value = result.fdcId;
          searchResults.appendChild(option)
        });
      }
      let timeout = null;
      const debounceTimeMillis = 300;
      function getSearchResultsDebounced() {
        clearTimeout(timeout);
        timeout = setTimeout(function() {
          timeout = null;
          google.script.run.withSuccessHandler(onSuccess).getSearchResults(
            queryInput.value, includeBranded.checked);
        }, debounceTimeMillis);
      };

      window.onload = function() {
        queryInput.focus();
      };
      includeBranded.addEventListener('change', function(event) {
        getSearchResultsDebounced();
      });
      queryInput.addEventListener('keyup', function(event) {
        getSearchResultsDebounced();
      });
      searchResults.addEventListener('change', function(event) {
        let fdcId = Number(event.target.value);
        let details = detailsByFdcId[fdcId];
        let detailsString = ''
        Object.keys(details).forEach(function(key) {
          detailsString += key + ': ' + details[key] + '\n';
        })
        searchDetails.innerText = detailsString;
      });
    </script>
  </body>
</html>